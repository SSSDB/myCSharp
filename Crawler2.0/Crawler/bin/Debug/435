<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin" />
    <meta property="og:description" content="Kubernetes 集群通过可靠和可扩展的方式对容器化应用进行托管，使得在 DevOps 思维和体系中，让运维服务、系统升级等工作变得超级简单。&#xA;Multipass 是一款可运行于 Linux、Wi" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>在 MacOS 中使用 multipass 安装 microk8s 环境 - sangmado - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.ico?v=20200522" type="image/x-icon" />
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=KCO3_f2W_TC__-jZ7phSnmoFkQuWMJH2yAgA16eE3eY" />
    <link id="MainCss" rel="stylesheet" href="/skins/imetro_hd/bundle-imetro_hd.min.css?v=gS0FloTY-RBJQcN3GCAKG6fAr6HHKtDMTw60VxjN79c" />
    <link type="text/css" rel="stylesheet" href="https://www.cnblogs.com/gaochundong/custom.css?v=VLtYtOrdiLux68PDhxkBxEtpdOM=" />
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/imetro_hd/bundle-imetro_hd-mobile.min.css?v=VacchHeVg6bp3gCO8NqMH8D8fhA8iyRbb0JgoDUvn4o" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/gaochundong/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/gaochundong/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/gaochundong/wlwmanifest.xml" />
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=6bwfCY2e02dLOXNW99G2BHZkYFmw9QyYTWeJ-W-sudo"></script>
    <script>
        var currentBlogId = 77744;
        var currentBlogApp = 'gaochundong';
        var cb_enable_mathjax = true;
        var isLogined = false;
        var skinName = 'iMetro_HD';
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
        tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processClass: 'math', processEscapes: true },
        TeX: {
        equationNumbers: { autoNumber: ['AMS'], useLabelIds: true },
        extensions: ['extpfeil.js', 'mediawiki-texvc.js'],
        Macros: {bm: "\\boldsymbol"}
        },
        'HTML-CSS': { linebreaks: { automatic: true } },
        SVG: { linebreaks: { automatic: true } }
        });
    </script>
    <script src="https://mathjax.cnblogs.com/2_7_5/MathJax.js?config=TeX-AMS-MML_HTMLorMML&amp;v=20200504"></script>
    
</head>
<body>
    <a name="top"></a>
    <div id="page_begin_html">
        <!--
<a href="https://github.com/gaochundong"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>
-->
    </div>
    
<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/gaochundong/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/gaochundong/">The Pleasure Of Craftsmanship</a>
</h1>
<h2>

</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/gaochundong/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/sangmado">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/gaochundong/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			
			<span id="stats_post_count">随笔 - 
205&nbsp; </span>
<span id="stats_article_count">文章 - 
0&nbsp; </span>
<span id="stats-comment_count">评论 - 
2051</span>

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class = "postTitle">
                
<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/gaochundong/p/install-microk8s-on-macos-using-multipass.html">在 MacOS 中使用 multipass 安装 microk8s 环境</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                
    <div id="cnblogs_post_description" style="display: none">
        Kubernetes 集群通过可靠和可扩展的方式对容器化应用进行托管，使得在 DevOps 思维和体系中，让运维服务、系统升级等工作变得超级简单。
Multipass 是一款可运行于 Linux、Windows 和 MacOS 的轻量级虚拟机管理器，它专为希望使用单个命令即可启动全新 Ubuntu 环境的开发人员而设计。它在 Linux 上使用 KVM、在 Windows 上使用 Hyper-V、在 MacOS 上使用 HyperKit，以便以最小的开销运行虚拟机。它还可以在 Windows 和 MacOS 上使用 VirtualBox。Multipass 将协助你获取最新镜像，并持续保持更新。
MicroK8S 是 CNCF 认证的 Kubernetes 部署环境，可在工作站或边缘设备上运行。作为一个 snap 包，它可以原生的运行所有 Kubernetes 服务，如果需要还可以打包类库和二进制文件。它的安装仅受限于你的下载速度，而删除 MicroK8S 后不会留下任何痕迹。
    </div>
<div id="cnblogs_post_body" class="blogpost-body ">
    <div>
<h1>在 MacOS 中使用 multipass 安装 microk8s 环境</h1>
<h2>Multipass &amp; MicroK8s 介绍</h2>
<h3>Kubernetes 是什么？</h3>
</div>
<p>Kubernetes 集群通过可靠和可扩展的方式对容器化应用进行托管，使得在 DevOps 思维和体系中，让运维服务、系统升级等工作变得超级简单。</p>
<h3>Multipass 是什么？</h3>
<p>Multipass 是一款可运行于 Linux、Windows 和 MacOS 的轻量级虚拟机管理器，它专为希望使用单个命令即可启动全新 Ubuntu 环境的开发人员而设计。它在 Linux 上使用 KVM、在 Windows 上使用 Hyper-V、在 MacOS 上使用 HyperKit，以便以最小的开销运行虚拟机。它还可以在 Windows 和 MacOS 上使用 VirtualBox。Multipass 将协助你获取最新镜像，并持续保持更新。</p>
<h3>MicroK8S 是什么？</h3>
<p>MicroK8S 是 CNCF 认证的 Kubernetes 部署环境，可在工作站或边缘设备上运行。作为一个 snap 包，它可以原生的运行所有 Kubernetes 服务，如果需要还可以打包类库和二进制文件。它的安装仅受限于你的下载速度，而删除 MicroK8S 后不会留下任何痕迹。</p>
<div>
<div>
<ul>
<li><span style="font-size: 14px;"><em>参考：<a href="https://ubuntu.com/tutorials/install-microk8s-on-windows#1-overview" target="_blank">Install MicroK8s on Windows using Multipass</a></em></span></li>
</ul>
</div>
<h2>安装 multipass &amp; microk8s</h2>
<h3>安装 multipass 服务</h3>
</div>
<div>
<div class="cnblogs_code">
<div>brew search multipass</div>
<div>brew cask info multipass</div>
<div>brew cask install multipass</div>
<div>multipass version</div>
</div>
<div>
<h3>通过 multipass 安装和启动 microk8s 环境</h3>
</div>
<div>
<div class="cnblogs_code">
<div>multipass launch --name microk8s-vm --mem 4G --disk 40G</div>
<div>multipass list</div>
<div>multipass stop microk8s-vm</div>
<div>multipass delete microk8s-vm</div>
<div>multipass purge</div>
</div>
<h3>在虚机中安装 microk8s 服务</h3>
<div>
<div class="cnblogs_code">multipass exec microk8s-vm -- sudo snap install microk8s --classic
<div>multipass exec microk8s-vm -- sudo iptables -P FORWARD ACCEPT</div>
</div>
<h3>查看 microk8s 的 snap 包信息，比如版本信息</h3>
<div>
<div class="cnblogs_code">&nbsp;multipass exec microk8s-vm -- sudo snap info microk8s</div>
<h3>增加账号访问权限，简化操作</h3>
<div>
<div class="cnblogs_code"># 默认 ubuntu 账号无权限操作集群，均需要 sudo
<div># 可将 ubuntu 账号加入 microk8s 用户组以便简化访问</div>
<div>multipass exec microk8s-vm -- sudo usermod -a -G microk8s ubuntu</div>
<div>multipass exec microk8s-vm -- sudo sudo chown -f -R ubuntu ~/.kube</div>
</div>
<h3>增加访问公钥，简化操作</h3>
</div>
<div>
<div>
<div class="cnblogs_code"># 在 ~/.ssh/authorized_keys 增加自己的公钥，则可方便的进行SSH登录
<div>multipass shell microk8s-vm</div>
<div>ssh ubuntu@192.168.64.2</div>
</div>
<div>
<h3>查看磁盘空间</h3>
</div>
<div>
<div class="cnblogs_code">multipass exec microk8s-vm -- df -kh</div>
<div>
<h3>查看 kubeconfig 配置</h3>
</div>
<div>
<div class="cnblogs_code">multipass exec microk8s-vm -- /snap/bin/microk8s.config</div>
<div>
<h3>在 kubeconfig 中可以找到集群信息，可登录查看</h3>
</div>
<div>
<div class="cnblogs_code">
<div>server: https://192.168.64.2:16443</div>
<div>username: admin</div>
<div>password: xxx</div>
</div>
<div>
<h3>增加 DNS 插件，必须安装，多处依赖使用</h3>
</div>
<div>
<div class="cnblogs_code">
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.enable dns</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.enable dashboard</div>
</div>
<h3>尝试访问 Grafana 地址</h3>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div>
<div>
<div class="cnblogs_code">https://192.168.64.2:16443/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy</div>
</div>
<div>
<div>
<h3>安装 Dashboard UI</h3>
</div>
<div>
<div>
<div class="cnblogs_code">multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml</div>
</div>
<div>
<div>
<h3>使用 Bearer Token 进行鉴权访问</h3>
</div>
<div>
<div>
<div class="cnblogs_code">
<div># 为安全考虑，Dashboard UI 需要使用 Bearer Token 进行鉴权访问，使用如下命令获取 Token</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl -n kube-system get secret | grep default-token | cut -d " " -f1</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl -n kube-system describe secret default-token-qqt75</div>
</div>
</div>
<div>
<div>
<h3>访问 Dashboard UI</h3>
</div>
<div>
<div>
<div class="cnblogs_code">https://192.168.64.2:16443/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</div>
</div>
<div>
<div>
<h3>查看集群组件状态</h3>
</div>
<div>
<div>
<div class="cnblogs_code">multipass exec microk8s-vm -- /snap/bin/microk8s.status</div>
</div>
<div>
<div>
<h3>可通过指定配置文件进行访问</h3>
</div>
<div>
<div>
<div class="cnblogs_code">
<div># 把kubeconfig保存至本地 /Users/xxx/.kube/microk8s-vm.yml，则可通过指定配置文件进行访问</div>
<div>kubectl --insecure-skip-tls-verify --kubeconfig="/Users/xxx/.kube/microk8s-vm.yml" get pods --all-namespaces</div>
<br />
<div># 把kubeconfig保存至本地 ~/.kube/config，则可通过指定配置文件进行访问</div>
<div>kubectl --insecure-skip-tls-verify get pods --all-namespaces</div>














</div>














</div>
<div>
<div>
<h3>安装 registry 组件</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>
<div># The MicroK8s registry will not be enabled by default, so needs run the following to enable it.</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.enable registry</div>














</div>















</div>















</div>
<div>
<div>
<h3>查看集群内组件状态</h3>














</div>
<div>
<div>
<div class="cnblogs_code">multipass exec microk8s-vm -- /snap/bin/microk8s.status | grep enabled</div>














</div>
<div>
<div>
<ul>
<li>
<p><span style="font-size: 14px;"><em>参考：<a href="https://github.com/gaochundong/dennis-productivity-tools/tree/master/microk8s" target="_blank">在 MacOS 中使用 multipass 安装 microk8s 环境</a></em></span></p>










</li>










</ul>
<h2>部署业务应用</h2>
<h3>业务应用 Demo 代码</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>urban-iptable-management # 简单的IP地址查询服务，服务自治，无外部依赖</div>
<div>urban-district-management # 简单的省市区查询服务，服务自治，无外部依赖</div>
<div>urban-traffic-management # 简单的模拟服务间调用，依赖 district 服务查询城市信息</div>
<div>urban-gateway-management # 模拟API网关，将访问转发至其他服务</div>














</div>














</div>
<div>
<div>
<ul>
<li>
<p><span style="font-size: 14px;"><em>Github Repo：<a href="https://github.com/gaochundong/urbanboot" target="_blank">https://github.com/gaochundong/urbanboot</a></em></span></p>











</li>














</ul>
<h3 class="_mce_tagged_br">本地 docker image 构建</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>cd urbanboot</div>














<br />
<div>docker build -t urban-iptable-management-app:latest --file ./urban-iptable-management/docker/Dockerfile .</div>
<div>docker build -t urban-district-management-app:latest --file ./urban-district-management/docker/Dockerfile .</div>
<div>docker build -t urban-traffic-management-app:latest --file ./urban-traffic-management/docker/Dockerfile .</div>
<div>docker build -t urban-gateway-management-app:latest --file ./urban-gateway-management/docker/Dockerfile .</div>














</div>














</div>
<div>
<div>
<h3>删除无用镜像</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>docker images</div>
<div>docker rmi --force $(docker images | grep "^&lt;none&gt;" | awk '{print $3}')</div>
<div>docker images</div>














</div>














</div>
<div>
<div>
<h3>保存本地镜像至文件</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div># Save one or more images to a tar archive</div>
<div>docker save -o urban-iptable-management-app.tar urban-iptable-management-app:latest</div>
<div>docker save -o urban-district-management-app.tar urban-district-management-app:latest</div>
<div>docker save -o urban-traffic-management-app.tar urban-traffic-management-app:latest</div>
<div>docker save -o urban-gateway-management-app.tar urban-gateway-management-app:latest</div>














</div>














</div>
<div>
<div>
<div>
<ul>
<li>
<p><span style="font-size: 14px;"><em>参考：<a href="https://www.ianlewis.org/en/container-runtimes-part-3-high-level-runtimes" target="_blank">Container Runtimes Part 3: High-Level Runtimes</a></em></span></p>











</li>














</ul>














</div>
<h3>拷贝镜像文件至 microk8s 机器</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>scp ./urban-iptable-management-app.tar ubuntu@192.168.64.2:/tmp</div>
<div>scp ./urban-district-management-app.tar ubuntu@192.168.64.2:/tmp</div>
<div>scp ./urban-traffic-management-app.tar ubuntu@192.168.64.2:/tmp</div>
<div>scp ./urban-gateway-management-app.tar ubuntu@192.168.64.2:/tmp</div>














</div>














</div>
<div>
<div>
<h3>安装镜像至 registry</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr namespaces list</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images list -q</div>














<br />
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images import /tmp/urban-iptable-management-app.tar</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images import /tmp/urban-district-management-app.tar</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images import /tmp/urban-traffic-management-app.tar</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images import /tmp/urban-gateway-management-app.tar</div>















<br />
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images list -q | grep urban</div>














</div>














</div>
<div>
<div>
<h3>删除镜像</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images remove docker.io/library/urban-iptable-management-app:latest</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images remove docker.io/library/urban-district-management-app:latest</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images remove docker.io/library/urban-traffic-management-app:latest</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.ctr images remove docker.io/library/urban-gateway-management-app:latest</div>














</div>















</div>















</div>
<div>
<div>
<h3>在部署文件中配置镜像位置</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>
<div># 替换deployment.yaml文件中的image路径</div>
<div>/Users/xxx/g/github/urbanboot/urban-district-management/kubernetes/deployment.yaml</div>














</div>















</div>















</div>
<div>
<div>
<h3>创建 Namespace</h3>














</div>
<div>
<div>
<div class="cnblogs_code">kubectl --insecure-skip-tls-verify create namespace urbanboot</div>














</div>
<div>
<div>
<h3>部署应用</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>kubectl --insecure-skip-tls-verify apply -f /Users/xxx/g/github/urbanboot/urban-iptable-management/kubernetes/deployment.yaml -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify apply -f /Users/xxx/g/github/urbanboot/urban-district-management/kubernetes/deployment.yaml -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify apply -f /Users/xxx/g/github/urbanboot/urban-traffic-management/kubernetes/deployment.yaml -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify apply -f /Users/xxx/g/github/urbanboot/urban-gateway-management/kubernetes/deployment.yaml -n urbanboot</div>














</div>














</div>
<div>
<div>
<h3>查看部署</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>kubectl --insecure-skip-tls-verify get deployments -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify get pods -n urbanboot</div>














</div>














</div>
<div>
<div>
<h3>删除部署，会自动删除 Pods</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>kubectl --insecure-skip-tls-verify delete deployment urban-iptable-management-app -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete deployment urban-district-management-app -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete deployment urban-traffic-management-app -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete deployment urban-gateway-management-app -n urbanboot</div>














</div>














</div>
<div>
<div>
<ul>
<li>
<p><span style="font-size: 14px;"><em>参考：<a href="https://medium.com/manikkothu/build-and-deploy-apps-on-microk8s-1df26d1ddd3c" target="_blank">Build apps locally and Deploy on MicroK8s</a></em></span></p>











</li>











</ul>
<h3>创建 Service</h3>














</div>
<div>
<div>
<div class="cnblogs_code">
<div>kubectl --insecure-skip-tls-verify get services -n urbanboot</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose -h</div>














<br />
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-iptable-management-app --type=ClusterIP --port=7200 --name=urban-iptable-management-app -n urbanboot</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-iptable-management-app --type=NodePort --port=7200 --name=urban-iptable-management-nodeport -n urbanboot</div>















<br />
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-district-management-app --type=ClusterIP --port=7200 --name=urban-district-management-app -n urbanboot</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-district-management-app --type=NodePort --port=7200 --name=urban-district-management-nodeport -n urbanboot</div>















<br />
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-traffic-management-app --type=ClusterIP --port=7200 --name=urban-traffic-management-app -n urbanboot</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-traffic-management-app --type=NodePort --port=7200 --name=urban-traffic-management-nodeport -n urbanboot</div>















<br />
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-gateway-management-app --type=ClusterIP --port=7200 --name=urban-gateway-management-app -n urbanboot</div>
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-gateway-management-app --type=NodePort --port=7200 --name=urban-gateway-management-nodeport -n urbanboot</div>















<br />
<div>multipass exec microk8s-vm -- /snap/bin/microk8s.kubectl expose deployment urban-traffic-management-app --type=LoadBalancer --port=7200 --name=urban-traffic-management-loadbalancer -n urbanboot</div>














</div>














</div>
<ul>
<li><span style="font-size: 14px;"><em>参考：<a href="https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0" target="_blank">Kubernetes NodePort vs LoadBalancer vs Ingress? When should I use what?</a></em></span></li>
<li><span style="font-size: 14px;"><em>The big downside is that each service you expose with a LoadBalancer will get its own IP address, and you have to pay for a LoadBalancer per exposed service, which can get expensive!</em></span></li>














</ul>
<h3>使用配置文件创建 Service</h3>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>
<div>
<div class="cnblogs_code">
<div>
<div>
<div>kubectl --insecure-skip-tls-verify expose -f /Users/xxx/g/github/urbanboot/urban-traffic-management/kubernetes/service.yaml -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify expose -f /Users/xxx/g/github/urbanboot/urban-traffic-management/kubernetes/nodeport.yaml -n urbanboot</div>














</div>














</div>















</div>















</div>














</div>
<div>
<div>
<div>
<h3>删除 Service</h3>














</div>
<div>
<div class="cnblogs_code">
<div>kubectl --insecure-skip-tls-verify delete service urban-iptable-management-app -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete service urban-iptable-management-nodeport -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete service urban-district-management-app -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete service urban-district-management-nodeport -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete service urban-traffic-management-app -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete service urban-traffic-management-nodeport -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete service urban-gateway-management-app -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify delete service urban-gateway-management-nodeport -n urbanboot</div>














</div>














</div>














</div>
<div>
<div>
<div>
<h3>查一下 TCP 端口监听</h3>














</div>
<div>
<div class="cnblogs_code">multipass exec microk8s-vm -- netstat -nl -t</div>














</div>














</div>
<div>
<div>
<div>
<h3>查看部署事件，按照时间排序</h3>














</div>
<div>
<div class="cnblogs_code">kubectl --insecure-skip-tls-verify get events -n urbanboot --sort-by=.metadata.creationTimestamp</div>














</div>














</div>
<div>
<div>
<div>
<h3>查看 Pod 日志</h3>














</div>
<div>
<div class="cnblogs_code">
<div>kubectl --insecure-skip-tls-verify get pods -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify describe pod urban-traffic-management-app-58d7578547-p277h -n urbanboot</div>
<div>
<div>kubectl --insecure-skip-tls-verify logs urban-traffic-management-app-58d7578547-p277h -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify logs urban-traffic-management-app-58d7578547-p277h -n urbanboot --tail=20</div>














</div>














</div>














</div>














</div>
<div>
<div>
<div>
<h3>查看 Endpoint 信息</h3>














</div>
<div>
<div class="cnblogs_code">
<div># Spring Cloud Kubernetes 会通过 API 查询 Endpoints</div>
<div>kubectl --insecure-skip-tls-verify get services -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify get endpoints -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify get all --all-namespaces</div>
<div>kubectl --insecure-skip-tls-verify get all -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify describe services urban-traffic-management-nodeport -n urbanboot</div>
<div>kubectl --insecure-skip-tls-verify describe services urban-traffic-management-app -n urbanboot</div>














</div>














</div>














</div>
<div>
<div>
<div>
<h3>访问 NodePort 端口</h3>














</div>
<div>
<div class="cnblogs_code">
<div>curl -s http://192.168.64.2:30211</div>
<div>curl -s http://192.168.64.2:30211 -i</div>
<div>curl -s http://192.168.64.2:30211 -v</div>














</div>














</div>














</div>
<div>
<div>
<div>
<h3>登录 Pod 环境</h3>














</div>
<div>
<div class="cnblogs_code">kubectl --insecure-skip-tls-verify exec -it urban-traffic-management-app-58d7578547-p277h -n urbanboot -- /bin/bash</div>














</div>














</div>
<div>
<div>
<div>
<h3>查看 Java 进程</h3>














</div>
<div>
<div class="cnblogs_code">
<div>java -version</div>
<div>env | grep JAVA</div>
<div>ps -ef|grep java</div>














</div>














</div>














</div>
<p><strong>版权声明：本篇文章《<a href="https://www.cnblogs.com/gaochundong/p/install-microk8s-on-macos-using-multipass.html" target="_blank">在 MacOS 中使用 multipass 安装 microk8s 环境</a>》由作者&nbsp;<a href="http://www.cnblogs.com/gaochundong/" target="_blank">Dennis Gao</a>&nbsp;发表自<a href="http://www.cnblogs.com/" target="_blank">博客园</a>个人技术博客，未经作者本人同意禁止以任何的形式转载，任何自动的或人为的爬虫转载行为均为耍流氓。</strong>




</p>









</div>














</div>














</div>














</div>














</div>














</div>














</div>














</div>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2020-05-30 18:10</span>&nbsp;
<a href="https://www.cnblogs.com/gaochundong/">sangmado</a>&nbsp;
阅读(<span id="post_view_count">...</span>)&nbsp;
评论(<span id="post_comment_count">...</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=12993807" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(12993807);return false;">收藏</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 77744, cb_blogApp = 'gaochundong', cb_blogUserGuid = '01e7fb75-bbe0-df11-ac81-842b2b196315';
    var cb_entryId = 12993807, cb_entryCreatedDate = '2020-05-30 18:10', cb_postType = 1; 
    loadViewCount(cb_entryId);
    loadSideColumnAd();
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>

<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
    </script>
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot("/1090369/C1", [300, 250], "div-gpt-ad-1546353474406-0").addService(googletag.pubads());
            googletag.defineSlot("/1090369/C2", [468, 60], "div-gpt-ad-1539008685004-0").addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;"></div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>
	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>

<div id="sidebar_ad"></div>
			<div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2020 sangmado
<br /><span id="poweredby">Powered by .NET Core on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    <div id="page_end_html">
        <script type="text/javascript" language="javascript"> 

$(document).ready(function () {
    var header_info_customization_timer_counter = 0;
    var header_info_customization_timer = setInterval(function ()
    {
        if (header_info_customization_timer_counter <= 3) {
            header_info_customization_timer_counter++;
        } else {
            clearInterval(header_info_customization_timer);
        }
		
		var url = location.href;
		if ((url.indexOf('www.cnblogs.com') != -1) && navigator.userAgent.match(/(iPhone|iPod|Android|ios|iPad)/i)) {
			if($("#blogTitle").length > 0) {
				$("#blogTitle").css("display", "none");
			}
			if($("#navigator").length > 0) {
				$("#navigator").css("display", "none");
			}
			if($(".blogStats").length > 0) {
				$(".blogStats").css("display", "none");
			}
			if($("#blog_post_info_block").length > 0) {
				$("#blog_post_info_block").css("display", "none");
			}
			clearInterval(header_info_customization_timer);
		} else {
			if ($(".blogStats").length > 0)
			{
				customize_stats_display();
				clearInterval(header_info_customization_timer);
			}
		}
    }, 500);
	
    var comment_customization_timer_counter = 0;
    var comment_customization_timer = setInterval(function ()
    {
        if (comment_customization_timer_counter <= 3) {
            comment_customization_timer_counter++;
        } else {
            clearInterval(comment_customization_timer);
        }
        if ($("#comment_pager_bottom").length > 0)
        {
            customize_comment_display();
            clearInterval(comment_customization_timer);
        }
    }, 500);
	
    var digg_customization_timer_counter = 0;
    var digg_customization_timer = setInterval(function ()
    {
        if (digg_customization_timer_counter <= 3) {
            digg_customization_timer_counter++;
        } else {
            clearInterval(digg_customization_timer);
        }
		
		var url = location.href;
		if ((url.indexOf('www.cnblogs.com') != -1) && navigator.userAgent.match(/(iPhone|iPod|Android|ios|iPad)/i)) {
			if($("#div_digg").length > 0) {
				$("#div_digg").css("display", "none");
			}
			clearInterval(digg_customization_timer);
		} else {		
			if($("#div_digg").length > 0)
			{
				$("#div_digg").prepend(
				  "<div id='follow_me' style='padding-bottom: 5px'>"+
					  "<a id='follow_me_dennis' onclick='follow_me();' href='javascript:void(0);' style='font-weight: bold; padding-left:5px;'>+加关注</a>" +
				  "</div>");

				$('#div_digg').append(
				  "<div id='goto_page_top' style='padding-top: 5px'>" +
					"<a onclick='javascript:goto_comment();' href='javascript:void(0);' style='font-weight: bold; padding-left: 5px;'>快速评论</a>" + 
					"&nbsp;&nbsp;" +
					"<a href='#top' style='font-weight: bold; padding-left: 5px;'>返回顶部</a>" +
				  "</div>");

				retrieve_follow_result();
				clearInterval(digg_customization_timer);
			}
		}
    }, 1000);
	
    var sidebar_post_list_customization_timer_counter = 0;
    var sidebar_post_list_customization_timer = setInterval(function ()
    {
        if (sidebar_post_list_customization_timer_counter <= 3) {
            sidebar_post_list_customization_timer_counter++;
        } else {
            clearInterval(sidebar_post_list_customization_timer);
        }
        if ($("#TopViewPostsBlock").length > 0 && $("#TopViewPostsBlock ul li").children().size() > 0)
        {
            customize_sidebar_post_list_display("#TopViewPostsBlock ul li");
            clearInterval(sidebar_post_list_customization_timer);
        }
    }, 800);
	
    //var sidebar_tag_cloud_customization_timer_counter = 0;
    //var sidebar_tag_cloud_customization_timer = setInterval(function ()
    //{
    //    if (sidebar_tag_cloud_customization_timer_counter <= 3) {
    //        sidebar_tag_cloud_customization_timer_counter++;
    //    } else {
    //        clearInterval(sidebar_post_list_customization_timer);
    //    }
    //    if ($(".catListTag").length > 0 && $(".catListTag ul li").children().size() > 0)
    //    {
    //        customize_sidebar_tag_cloud_display();
    //        clearInterval(sidebar_tag_cloud_customization_timer);
    //    }
    //}, 600);

    var sidebar_hide_customization_timer_counter = 0;
    var sidebar_hide_customization_timer = setInterval(function ()
    {
        if (sidebar_hide_customization_timer_counter <= 3) {
            sidebar_hide_customization_timer_counter++;
        } else {
            clearInterval(sidebar_hide_customization_timer);
        }
        if ($("div#main #mainContent #post_detail #topics .post").length > 0 && $("div#main #mainContent #post_detail #topics .post").children().size() > 0)
        {
            customize_sidebar_hide_display();
            clearInterval(sidebar_hide_customization_timer);
        }
    }, 100);
});

function retrieve_follow_result() {
    var retrieve_follow_result_timer_counter = 0;
    var retrieve_follow_result_timer = setInterval(function ()
    {
        if (retrieve_follow_result_timer_counter <= 3) {
            retrieve_follow_result_timer_counter++;
        } else {
            clearInterval(retrieve_follow_result_timer);
        }
		
        var follow_result_text = $('#p_b_follow').text();
        if(follow_result_text == '关注成功' || follow_result_text == '关注失败' || follow_result_text == '已关注 -取消')
        {
            $('#follow_me_dennis').text('感谢您的关注');
            clearTimeout(retrieve_follow_result_timer);
        }
        else if(follow_result_text == '+加关注')
        {
            clearTimeout(retrieve_follow_result_timer);
        }
    }, 500);
}

function follow_me() {
    cnblogs.UserManager.FollowBlogger('01e7fb75-bbe0-df11-ac81-842b2b196315');
    retrieve_follow_result();
}

function goto_comment() { 
    document.getElementById("tbCommentBody").focus(); 
}

function customize_comment_display() {
    var comment_table_part1 =
    '<div class="dennis_comment_list">' +
        '<table class="dennis_comment_table_commentator" border="0" cellspacing="0" cellpadding="0"> ' +
        '<tr>' +
            '<td class="dennis_comment" align="left" valign="top">' +
                '<table class="dennis_comment_table_inner_right" border="0" cellpadding="0" cellspacing="0"> ' +
                    '<tr><td class="dennis_comment_topleft"></td><td class="top"></td><td class="dennis_comment_topright"></td></tr> ' +
                    '<tr><td class="dennis_comment_left"></td> <td class="dennis_comment_center" align="left"><p>';

    var comment_table_part2 = '</p> </td> <td class="right"></td></tr> ' +
                    '<tr><td class="dennis_comment_bottomleft"></td><td class="dennis_comment_bottom"></td><td class="dennis_comment_bottomright"></td></tr> ' +
                '</table>' +
            '</td> ' +
            '<td class="dennis_comment_avatar" align="right" valign="top">' +
                '<img src="';
				
    var comment_table_part3 = '"/>' +
            '</td>' +
        '</tr> ' +
        '</table> ' +
    '</div>';

    $.each($(".feedbackItem"), function (i, item) {	
        var comment_item_body = $(item).find(".blog_comment_body");
        var comment_item_body_id = comment_item_body[0].id; 
        var comment_item_id = comment_item_body_id.substr(comment_item_body_id.lastIndexOf("_") + 1);
        var comment_item_commentator_avatar_url = $("#comment_" + comment_item_id + "_avatar").html();
        if(comment_item_commentator_avatar_url == null){
            var random_avatar_number = Math.floor((Math.random() * 10) + 1);
            comment_item_commentator_avatar_url = 'http://images.cnblogs.com/cnblogs_com/gaochundong/638641/o_commentator_identicons_default_avatar' + random_avatar_number +'.png';
        }
	
        $(comment_item_body).html(comment_table_part1 + $(comment_item_body).html() + comment_table_part2 + comment_item_commentator_avatar_url + comment_table_part3);
    });
    $(".louzhu").closest(".feedbackItem").find(".dennis_comment_table_commentator").removeClass("dennis_comment_table_commentator").addClass("dennis_comment_table_louzhu");
}

function customize_stats_display() {
    var stats = $(".blogStats").html().toString().replace(/[\n|\t]/g, "");
    var blogs = /随笔\s*\-\s*(\d+)/;
    var comments = /评论\s*\-\s*(\d+)/;
    var blog_count = stats.match(blogs);
    var comment_count = stats.match(comments);
    var new_stats = "<font>{ 文章 : " + blog_count[1] + ", 评论 : " + comment_count[1] + " }</font>";
    $(".blogStats").html(new_stats)
}

function customize_sidebar_tag_cloud_display() {
    $(".catListTag .catListTitle").html("标签");
    $(".catListTag").css("overflow", "hidden");
	
    $(".catListTag ul").append(
		'<li><a href="http://www.cnblogs.com/gaochundong/tag/Inversion%20of%20Control/">Inversion of Control</a>(11)</li>'
		+ '<li><a href="http://www.cnblogs.com/gaochundong/tag/Entity%20Framework/">Entity Framework</a>(33)</li>'
		+ '<li><a href="http://www.cnblogs.com/gaochundong/tag/Performance%20Tuning/">Performance Tuning</a>(15)</li>'
		+ '<li><a href="http://www.cnblogs.com/gaochundong/tag/TDD/">TDD</a>(60)</li>'
		+ '<li><a href="http://www.cnblogs.com/gaochundong/tag/WinDbg/">WinDbg</a>(40)</li>'
		+ '<li><a href="http://www.cnblogs.com/gaochundong/tag/WCF/">WCF</a>(35)</li>');
		
    $(".catListTag ul li").each(function (i, item) {
        var link = $(item).find('a').attr('href');
        var tag = $(item).find('a').text();
        var text = $(item).text();
        var count = text.match(/.*\((\d+)\).*/);
        if(count == null) {
            $(item).remove();
            return true;
        }
        var fontsize = Math.ceil((count[1] / 30) * 100 + 50) + "%";
        var lineheight = Math.ceil(Math.ceil((count[1] / 45) * 100 + 50) / 100 * 22) + "px";
        $(item)
			.html("<a href='" + link + "' target='_blank' title='" + text +"'>" + tag + "</a>")
			.css("font-size", fontsize)
			.css("line-height", lineheight);
    });

    $(".catListTag ul").each(function(){
        var $ul = $(this);
        var $items = $ul.children('li');
        $items.sort( function(a, b){
            var r = parseInt( Math.random() * 10 );
            var isOddOrEven = r % 2;
            var isPosOrNeg = r > 5 ? 1 : -1;
            return (isOddOrEven * isPosOrNeg);
        })
		.appendTo($ul);            
    }).append('<li><a href="http://www.cnblogs.com/gaochundong/tag/">更多...</a></li>');
}

function customize_sidebar_post_list_display(selectorName) {
    $(selectorName).each( function (i, item) {
        var post_link = $(item).find('a').attr('href');
        var post_title = $(item).find('a').text();

        var regex = /(.+)(\(\d+\))/;
        var groups = post_title.match(regex);
        var prefix = groups[1];
        var number = groups[2];
		
        var total_length = 31;
        var dots = " ";
        var limit = total_length - number.length;
        var prefix_length = get_length(prefix);
        // if (prefix_length > limit - dots.length) {
        //    dots = "...";
        //    prefix = cut_str(prefix, limit - dots.length);            
        // }

        $(item).html("<a href='" + post_link + "' target='_blank' title='" + post_title +"'>" + prefix + dots + number + "</a>");
    });
}

function customize_sidebar_hide_display() {
    $("div#sideBar").css("display", "none");
    $("div#main #mainContent .forFlow").css("padding-right", "0px");
}

function get_length(str) {
    var l = 0, c = -1;
    for (var i = 0; i < str.length; i++) {
        c = str.charCodeAt(i);
        if (c >= 0 && c <= 128) l += 1;
        else l += 2;
    }
    return l;
}

function cut_str(str, len) {
    var str_length = 0;  
    var str_len = 0;  
    str_cut = new String();  
    str_len = str.length;  
    for(var i = 0; i < str_len; i++)  
    {  
        a = str.charAt(i);  
        str_length++;  
        if(escape(a).length > 4)  
        {  
            //中文字符的长度经编码之后大于4  
            str_length++;  
        }  
        str_cut = str_cut.concat(a);  
        if(str_length>=len)  
        {  
            str_cut = str_cut.concat("...");  
            return str_cut;  
        }  
    }  
    //如果给定字符串小于指定长度，则返回源字符串；  
    if(str_length < len){  
        return  str;  
    } 
}

</script>
    </div>
</body>
</html>
